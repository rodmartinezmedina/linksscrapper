import{Settings as e,ObjectWrapper as t,UIString as n}from"../common/common.js";import{Widget as s,UIUtils as a,SettingsUI as i,Utils as o,Toolbar as r,Icon as d}from"../ui/ui.js";import{TargetDetachedDialog as l}from"../components/components.js";import{InspectorFrontendHost as c,InspectorFrontendHostAPI as g}from"../host/host.js";import{NetworkPanelIndicator as u}from"../mobile_throttling/mobile_throttling.js";import{Connections as h,SDKModel as p,DebuggerModel as m,ResourceTreeModel as S,ChildTargetManager as b}from"../sdk/sdk.js";class _ extends s.VBox{constructor(){super(!0),this.registerRequiredCSS("inspector_main/renderingOptions.css"),this._appendCheckbox(ls`Paint flashing`,ls`Highlights areas of the page (green) that need to be repainted. May not be suitable for people prone to photosensitive epilepsy.`,e.Settings.instance().moduleSetting("showPaintRects")),this._appendCheckbox(ls`Layout Shift Regions`,ls`Highlights areas of the page (blue) that were shifted. May not be suitable for people prone to photosensitive epilepsy.`,e.Settings.instance().moduleSetting("showLayoutShiftRegions")),this._appendCheckbox(ls`Layer borders`,ls`Shows layer borders (orange/olive) and tiles (cyan).`,e.Settings.instance().moduleSetting("showDebugBorders")),this._appendCheckbox(ls`Frame Rendering Stats`,ls`Plots frame throughput, dropped frames distribution, and GPU memory.`,e.Settings.instance().moduleSetting("showFPSCounter")),this._appendCheckbox(ls`Scrolling performance issues`,ls`Highlights elements (teal) that can slow down scrolling, including touch & wheel event handlers and other main-thread scrolling situations.`,e.Settings.instance().moduleSetting("showScrollBottleneckRects")),this._appendCheckbox(ls`Highlight ad frames`,ls`Highlights frames (red) detected to be ads.`,e.Settings.instance().moduleSetting("showAdHighlights")),this._appendCheckbox(ls`Hit-test borders`,ls`Shows borders around hit-test regions.`,e.Settings.instance().moduleSetting("showHitTestBorders")),this._appendCheckbox(ls`Disable local fonts`,ls`Disables local() sources in @font-face rules. Requires a page reload to apply.`,e.Settings.instance().moduleSetting("localFontsDisabled")),this._appendCheckbox(ls`Emulate a focused page`,ls`Emulates a focused page.`,e.Settings.instance().moduleSetting("emulatePageFocus")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this._appendSelect(ls`Forces media type for testing print and screen styles`,e.Settings.instance().moduleSetting("emulatedCSSMedia")),this._appendSelect(ls`Forces CSS prefers-color-scheme media feature`,e.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersColorScheme")),this._appendSelect(ls`Forces CSS prefers-reduced-motion media feature`,e.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedMotion")),(()=>{const e="(prefers-reduced-data: reduce)";return window.matchMedia(e).media===e})()&&this._appendSelect(ls`Forces CSS prefers-reduced-data media feature`,e.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedData")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this._appendSelect(ls`Forces vision deficiency emulation`,e.Settings.instance().moduleSetting("emulatedVisionDeficiency"))}_appendCheckbox(e,t,n){const s=a.CheckboxLabel.create(e,!1,t);i.bindCheckbox(s.checkboxElement,n),this.contentElement.appendChild(s)}_appendSelect(e,t){const n=i.createControlForSetting(t,e);n&&this.contentElement.appendChild(n)}}var f=Object.freeze({__proto__:null,RenderingOptionsView:_});class C extends t.ObjectWrapper{async run(){let e=!0;await h.initMainConnection(async()=>{const t=Root.Runtime.queryParam("v8only")?p.Type.Node:p.Type.Frame,s=t===p.Type.Frame&&"sources"===Root.Runtime.queryParam("panel"),a=p.TargetManager.instance().createTarget("main",n.UIString("Main"),t,null,void 0,s);if(e){if(e=!1,s){const e=a.model(m.DebuggerModel);e.isReadyToPause()||await e.once(m.Events.DebuggerIsReadyToPause),e.pause()}a.runtimeAgent().runIfWaitingForDebugger()}},l.TargetDetachedDialog.webSocketConnectionLost),new w,new y,new u.NetworkPanelIndicator,c.InspectorFrontendHostInstance.events.addEventListener(g.Events.ReloadInspectedPage,e=>{const t=e.data;S.ResourceTreeModel.reloadAllPages(t)})}}class w{constructor(){function t(){let t=null;e.Settings.instance().moduleSetting("javaScriptDisabled").get()&&(t=d.Icon.create("smallicon-warning"),t.title=n.UIString("JavaScript is disabled")),self.UI.inspectorView.setPanelIcon("sources",t)}e.Settings.instance().moduleSetting("javaScriptDisabled").addChangeListener(t),t()}}class y{constructor(){this._autoAttachSetting=e.Settings.instance().moduleSetting("autoAttachToCreatedPages"),this._autoAttachSetting.addChangeListener(this._updateAutoAttach,this),this._updateAutoAttach(),this._adBlockEnabledSetting=e.Settings.instance().moduleSetting("network.adBlockingEnabled"),this._adBlockEnabledSetting.addChangeListener(this._update,this),this._emulatePageFocusSetting=e.Settings.instance().moduleSetting("emulatePageFocus"),this._emulatePageFocusSetting.addChangeListener(this._update,this),p.TargetManager.instance().observeTargets(this)}_updateTarget(e){e.type()!==p.Type.Frame||e.parentTarget()||(e.pageAgent().setAdBlockingEnabled(this._adBlockEnabledSetting.get()),e.emulationAgent().setFocusEmulationEnabled(this._emulatePageFocusSetting.get()))}_updateAutoAttach(){c.InspectorFrontendHostInstance.setOpenNewWindowForPopups(this._autoAttachSetting.get())}_update(){for(const e of p.TargetManager.instance().targets())this._updateTarget(e)}targetAdded(e){this._updateTarget(e)}targetRemoved(e){}}b.ChildTargetManager.install();var T=Object.freeze({__proto__:null,InspectorMainImpl:C,ReloadActionDelegate:class{handleAction(e,t){switch(t){case"inspector_main.reload":return S.ResourceTreeModel.reloadAllPages(!1),!0;case"inspector_main.hard-reload":return S.ResourceTreeModel.reloadAllPages(!0),!0}return!1}},FocusDebuggeeActionDelegate:class{handleAction(e,t){return p.TargetManager.instance().mainTarget().pageAgent().bringToFront(),!0}},NodeIndicator:class{constructor(){const e=createElement("div"),t=o.createShadowRootWithCoreStyles(e,"inspector_main/nodeIcon.css");this._element=t.createChild("div","node-icon"),e.addEventListener("click",()=>c.InspectorFrontendHostInstance.openNodeFrontend(),!1),this._button=new r.ToolbarItem(e),this._button.setTitle(n.UIString("Open dedicated DevTools for Node.js")),p.TargetManager.instance().addEventListener(p.Events.AvailableTargetsChanged,e=>this._update(e.data)),this._button.setVisible(!1),this._update([])}_update(e){const t=!!e.find(e=>"node"===e.type&&!e.attached);this._element.classList.toggle("inactive",!t),t&&this._button.setVisible(!0)}item(){return this._button}},SourcesPanelIndicator:w,BackendSettingsSync:y});export{T as InspectorMain,f as RenderingOptions};
